{"ast":null,"code":"var _jsxFileName = \"/Users/dhirajbalayar/Desktop/fashion/frontend/src/pages/Measure.jsx\",\n  _s = $RefreshSig$();\n// src/pages/Measure.jsx\nimport React, { useRef, useEffect, useState, useCallback } from \"react\";\nimport { Pose } from \"@mediapipe/pose\";\nimport { Camera } from \"@mediapipe/camera_utils\";\n\n/* ---------- Calibration ---------- */\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst A4_WIDTH_CM = 21.0; // reference width\nconst CHEST_MULTIPLIER = 1.95; // bumped: shoulder flat → chest circumference\nconst UPPER_WAIST_FACTOR = 0.90; // hip width ≈ a bit wider than upper waist\n\n/* ---------- Overlay helpers ---------- */\nconst UPPER = [[0, 1], [1, 2], [2, 3], [3, 7], [0, 11], [0, 12], [11, 13], [13, 15], [12, 14], [14, 16], [11, 12], [11, 23], [12, 24]];\nconst LOWER = [[23, 25], [25, 27], [27, 31], [24, 26], [26, 28], [28, 32], [23, 24]];\nconst drawSeg = (ctx, lm, a, b, color, width, W, H) => {\n  var _A$visibility, _B$visibility;\n  const A = lm[a],\n    B = lm[b];\n  if (!A || !B) return;\n  if (((_A$visibility = A.visibility) !== null && _A$visibility !== void 0 ? _A$visibility : 0) < 0.4 || ((_B$visibility = B.visibility) !== null && _B$visibility !== void 0 ? _B$visibility : 0) < 0.4) return;\n  ctx.strokeStyle = color;\n  ctx.lineWidth = width;\n  ctx.beginPath();\n  ctx.moveTo(A.x * W, A.y * H);\n  ctx.lineTo(B.x * W, B.y * H);\n  ctx.stroke();\n};\nconst drawBBox = (ctx, lm, W, H, color = \"rgba(0,255,0,0.9)\") => {\n  const pts = lm.filter(p => {\n    var _p$visibility;\n    return ((_p$visibility = p === null || p === void 0 ? void 0 : p.visibility) !== null && _p$visibility !== void 0 ? _p$visibility : 0) > 0.4;\n  });\n  if (!pts.length) return;\n  const xs = pts.map(p => p.x * W),\n    ys = pts.map(p => p.y * H);\n  const minX = Math.max(0, Math.min(...xs)),\n    maxX = Math.min(W, Math.max(...xs));\n  const minY = Math.max(0, Math.min(...ys)),\n    maxY = Math.min(H, Math.max(...ys));\n  const pad = 8;\n  ctx.strokeStyle = color;\n  ctx.lineWidth = 3;\n  ctx.strokeRect(minX - pad, minY - pad, maxX - minX + pad * 2, maxY - minY + pad * 2);\n};\n\n/* ---------- T-Shirt Size recommendation ---------- */\nconst recommendTopSize = chestCm => {\n  if (!chestCm || isNaN(chestCm)) return \"Unable to determine\";\n\n  // Standard T-shirt chest measurements (in cm)\n  const table = [{\n    size: \"XS\",\n    min: 76,\n    max: 84\n  }, {\n    size: \"S\",\n    min: 84,\n    max: 92\n  }, {\n    size: \"M\",\n    min: 92,\n    max: 100\n  }, {\n    size: \"L\",\n    min: 100,\n    max: 108\n  }, {\n    size: \"XL\",\n    min: 108,\n    max: 116\n  }, {\n    size: \"XXL\",\n    min: 116,\n    max: 124\n  }, {\n    size: \"XXXL\",\n    min: 124,\n    max: 132\n  }];\n\n  // Find exact match\n  const hit = table.find(r => chestCm >= r.min && chestCm < r.max);\n  if (hit) return hit.size;\n\n  // Handle edge cases\n  if (chestCm < table[0].min) return \"XS (might be tight)\";\n  if (chestCm >= table[table.length - 1].max) return \"XXXL+ (custom size needed)\";\n  return \"Size not found\";\n};\n\n// T-shirt fit recommendation based on body measurements\nconst getTshirtFitAdvice = (chestCm, shoulderCm) => {\n  if (!chestCm || !shoulderCm) return \"Get measurements first for fit advice.\";\n  const ratio = chestCm / shoulderCm;\n  if (ratio < 2.1) {\n    return \"Consider: Slim/fitted t-shirts will suit your build.\";\n  } else if (ratio > 2.4) {\n    return \"Consider: Regular/relaxed fit t-shirts for comfort.\";\n  } else {\n    return \"Consider: Most t-shirt fits should work well.\";\n  }\n};\nexport default function Measure() {\n  _s();\n  var _cmPerPx$toFixed, _cmPerPx$toFixed2, _debugInfo$shoulderCm, _debugInfo$chestCm, _debugInfo$frames;\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const poseRef = useRef(null);\n  const camRef = useRef(null);\n  const [phase, setPhase] = useState(\"calibrate\"); // 'calibrate' | 'measure' | 'locked'\n  const [status, setStatus] = useState(\"Hold an A4 sheet at chest level and match the bar width.\");\n  const [barPx, setBarPx] = useState(300);\n  const [cmPerPx, setCmPerPx] = useState(null);\n  const [locked, setLocked] = useState(false);\n  const [meas, setMeas] = useState(null); // { chestCm, shoulderCm, upperWaistCm, quality, _shoulderPx }\n\n  // Relaxed stability settings for better capture\n  const GUIDE_MARGIN = 0.12; // Increased margin for easier positioning\n  const STABILITY_FRAMES = 8; // Reduced frames needed for stability\n  const MOVEMENT_EPS = 0.025; // Relaxed movement threshold\n  const recentShoulderN = useRef([]);\n  const chestBuf = useRef([]);\n  const shoulderBuf = useRef([]);\n  const waistBuf = useRef([]);\n\n  // Relaxed sanity bounds\n  const SHOULDER_MIN = 30,\n    SHOULDER_MAX = 70; // cm - wider range\n  const CHEST_MIN = 70,\n    CHEST_MAX = 150; // cm - wider range\n\n  // Debug state\n  const [debugInfo, setDebugInfo] = useState({});\n  const getDistance = useCallback((a, b) => Math.hypot(a.x - b.x, a.y - b.y), []);\n  const stopCamera = () => {\n    try {\n      var _camRef$current, _camRef$current$stop;\n      (_camRef$current = camRef.current) === null || _camRef$current === void 0 ? void 0 : (_camRef$current$stop = _camRef$current.stop) === null || _camRef$current$stop === void 0 ? void 0 : _camRef$current$stop.call(_camRef$current);\n      const v = videoRef.current;\n      if (v !== null && v !== void 0 && v.srcObject) {\n        v.srcObject.getTracks().forEach(t => t.stop());\n        v.srcObject = null;\n      }\n    } catch (e) {\n      console.log(\"Stop camera error:\", e);\n    }\n  };\n  const startCamera = async pose => {\n    try {\n      const v = videoRef.current;\n      const camera = new Camera(v, {\n        onFrame: async () => {\n          if (v.readyState === 4) {\n            // HAVE_ENOUGH_DATA\n            await pose.send({\n              image: v\n            });\n          }\n        },\n        width: 1280,\n        height: 720\n      });\n      camRef.current = camera;\n      await camera.start();\n    } catch (e) {\n      console.error(\"Camera start error:\", e);\n      setStatus(\"Camera access failed. Please allow camera permission.\");\n    }\n  };\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext(\"2d\");\n    const pose = new Pose({\n      locateFile: file => `/mediapipe/pose/${file.replace('simd_', '')}`\n    });\n    poseRef.current = pose;\n    pose.setOptions({\n      modelComplexity: 1,\n      smoothLandmarks: true,\n      enableSegmentation: false,\n      minDetectionConfidence: 0.4,\n      // Lowered for better detection\n      minTrackingConfidence: 0.4 // Lowered for better tracking\n    });\n    pose.onResults(res => {\n      if (locked) return;\n      const W = res.image.width,\n        H = res.image.height;\n      if (canvas.width !== W) canvas.width = W;\n      if (canvas.height !== H) canvas.height = H;\n      ctx.save();\n      ctx.clearRect(0, 0, W, H);\n      ctx.drawImage(res.image, 0, 0, W, H);\n\n      // guide box\n      const gx = W * GUIDE_MARGIN,\n        gy = H * GUIDE_MARGIN;\n      const gW = W * (1 - GUIDE_MARGIN * 2),\n        gH = H * (1 - GUIDE_MARGIN * 2);\n      ctx.strokeStyle = \"rgba(125,255,160,0.85)\";\n      ctx.lineWidth = 3;\n      ctx.strokeRect(gx, gy, gW, gH);\n\n      // calibration bar\n      if (phase === \"calibrate\") {\n        const barH = 14;\n        ctx.fillStyle = \"rgba(255,255,255,0.95)\";\n        ctx.fillRect((W - barPx) / 2, H * 0.1, barPx, barH);\n        ctx.font = \"14px system-ui, sans-serif\";\n        ctx.fillStyle = \"rgba(255,255,255,0.95)\";\n        ctx.fillText(\"Match this bar to A4 width (21 cm) at chest depth.\", Math.max(12, (W - 360) / 2), H * 0.1 - 8);\n      }\n      const lm = res.poseLandmarks;\n      if (!lm || lm.length === 0) {\n        setStatus(\"Detecting body…\");\n        setDebugInfo({\n          error: \"No landmarks detected\"\n        });\n        ctx.restore();\n        return;\n      }\n\n      // overlay (screenshot style)\n      drawBBox(ctx, lm, W, H);\n      UPPER.forEach(([a, b]) => drawSeg(ctx, lm, a, b, \"#2aa4ff\", 3, W, H));\n      LOWER.forEach(([a, b]) => drawSeg(ctx, lm, a, b, \"#ff9933\", 3, W, H));\n\n      // Check visibility with lower threshold\n      const vis = i => {\n        var _lm$i$visibility, _lm$i;\n        return ((_lm$i$visibility = (_lm$i = lm[i]) === null || _lm$i === void 0 ? void 0 : _lm$i.visibility) !== null && _lm$i$visibility !== void 0 ? _lm$i$visibility : 0) > 0.3;\n      }; // Lowered from 0.45\n      const shouldersOK = vis(11) && vis(12);\n      const hipsOK = vis(23) || vis(24);\n      if (!(shouldersOK && hipsOK)) {\n        var _lm$11$visibility, _lm$, _lm$12$visibility, _lm$2, _lm$23$visibility, _lm$3, _lm$24$visibility, _lm$4;\n        setStatus(\"Show shoulders & upper torso clearly.\");\n        setDebugInfo({\n          shoulder11: (_lm$11$visibility = (_lm$ = lm[11]) === null || _lm$ === void 0 ? void 0 : _lm$.visibility) !== null && _lm$11$visibility !== void 0 ? _lm$11$visibility : 0,\n          shoulder12: (_lm$12$visibility = (_lm$2 = lm[12]) === null || _lm$2 === void 0 ? void 0 : _lm$2.visibility) !== null && _lm$12$visibility !== void 0 ? _lm$12$visibility : 0,\n          hip23: (_lm$23$visibility = (_lm$3 = lm[23]) === null || _lm$3 === void 0 ? void 0 : _lm$3.visibility) !== null && _lm$23$visibility !== void 0 ? _lm$23$visibility : 0,\n          hip24: (_lm$24$visibility = (_lm$4 = lm[24]) === null || _lm$4 === void 0 ? void 0 : _lm$4.visibility) !== null && _lm$24$visibility !== void 0 ? _lm$24$visibility : 0\n        });\n        ctx.restore();\n        return;\n      }\n      const Lsh = lm[11],\n        Rsh = lm[12];\n      const Lhip = lm[23],\n        Rhip = lm[24];\n      const hip = vis(23) ? Lhip : Rhip;\n\n      // key dots\n      const shMid = {\n        x: (Lsh.x + Rsh.x) / 2,\n        y: (Lsh.y + Rsh.y) / 2\n      };\n      ctx.fillStyle = \"rgba(0,200,255,1)\";\n      [Lsh, Rsh, shMid, hip].forEach(p => {\n        ctx.beginPath();\n        ctx.arc(p.x * W, p.y * H, 6, 0, Math.PI * 2);\n        ctx.fill();\n      });\n\n      // Relaxed inside check\n      const inside = [Lsh, Rsh, hip].every(p => p.x * W >= gx - 20 && p.x * W <= gx + gW + 20 && p.y * H >= gy - 20 && p.y * H <= gy + gH + 20);\n      if (!inside) {\n        setStatus(\"Step back/center - get shoulders and torso in frame.\");\n        setDebugInfo({\n          insideFrame: inside\n        });\n        ctx.restore();\n        return;\n      }\n      if (phase === \"calibrate\") {\n        setStatus(\"Good position! Adjust bar width → Set calibration.\");\n        ctx.restore();\n        return;\n      }\n      if (!cmPerPx) {\n        setStatus(\"Click 'Set calibration' first.\");\n        ctx.restore();\n        return;\n      }\n\n      // normalized stability\n      const shoulderWidthN = getDistance(Lsh, Rsh);\n      const torsoHeightN = getDistance(shMid, hip);\n      if (torsoHeightN <= 0) {\n        setStatus(\"Hold still…\");\n        ctx.restore();\n        return;\n      }\n      const bufN = recentShoulderN.current;\n      bufN.push(shoulderWidthN);\n      if (bufN.length > STABILITY_FRAMES) bufN.shift();\n      const avg = bufN.length > 0 ? bufN.reduce((a, b) => a + b, 0) / bufN.length : 0;\n      const maxDev = bufN.length > 0 ? Math.max(...bufN.map(v => Math.abs(v - avg))) : 999;\n\n      // ----- measurements in cm -----\n      const shoulderPx = Math.abs((Lsh.x - Rsh.x) * W);\n      const shoulderCm = shoulderPx * cmPerPx;\n      const chestCmInstant = shoulderCm * CHEST_MULTIPLIER;\n      let upperWaistCmInstant = null;\n      if (vis(23) && vis(24)) {\n        const hipFlatCm = Math.abs((Lhip.x - Rhip.x) * W) * cmPerPx;\n        upperWaistCmInstant = hipFlatCm * UPPER_WAIST_FACTOR;\n      }\n\n      // median smoothing with shorter buffer for faster response\n      const pushMed = (ref, val, n = 8) => {\n        // Reduced from 15 to 8\n        if (val == null) return null;\n        ref.current.push(val);\n        if (ref.current.length > n) ref.current.shift();\n        const s = [...ref.current].sort((a, b) => a - b);\n        const m = Math.floor(s.length / 2);\n        return s.length % 2 ? s[m] : (s[m - 1] + s[m]) / 2;\n      };\n      const chestMed = pushMed(chestBuf, chestCmInstant);\n      const shoulderMed = pushMed(shoulderBuf, shoulderCm);\n      const waistMed = pushMed(waistBuf, upperWaistCmInstant);\n\n      // Relaxed stability check\n      const spread = chestBuf.current.length >= 5 ? Math.max(...chestBuf.current) - Math.min(...chestBuf.current) : 999;\n      const stable = bufN.length >= STABILITY_FRAMES && maxDev < MOVEMENT_EPS && spread < 3.0; // Relaxed spread\n\n      // Relaxed sanity check\n      const shoulderOk = shoulderMed > SHOULDER_MIN && shoulderMed < SHOULDER_MAX;\n      const chestOk = chestMed > CHEST_MIN && chestMed < CHEST_MAX;\n\n      // Update debug info\n      setDebugInfo({\n        shoulderPx: shoulderPx.toFixed(1),\n        shoulderCm: shoulderMed === null || shoulderMed === void 0 ? void 0 : shoulderMed.toFixed(1),\n        chestCm: chestMed === null || chestMed === void 0 ? void 0 : chestMed.toFixed(1),\n        stable,\n        maxDev: maxDev.toFixed(4),\n        spread: spread.toFixed(2),\n        bufferLength: bufN.length,\n        shoulderOk,\n        chestOk,\n        frames: chestBuf.current.length\n      });\n      if (stable && chestMed && shoulderMed) {\n        if (!shoulderOk || !chestOk) {\n          setStatus(`Calibration issue - Shoulder: ${shoulderMed === null || shoulderMed === void 0 ? void 0 : shoulderMed.toFixed(1)}cm, Chest: ${chestMed === null || chestMed === void 0 ? void 0 : chestMed.toFixed(1)}cm - Please recalibrate.`);\n          ctx.restore();\n          return;\n        }\n        const out = {\n          chestCm: Number(chestMed.toFixed(1)),\n          shoulderCm: Number(shoulderMed.toFixed(1)),\n          upperWaistCm: waistMed ? Number(waistMed.toFixed(1)) : undefined,\n          quality: {\n            frames: chestBuf.current.length,\n            spreadCm: Number(spread.toFixed(2)),\n            stability: Number(maxDev.toFixed(4))\n          },\n          _shoulderPx: Number(shoulderPx.toFixed(1))\n        };\n        setMeas(out);\n        setLocked(true);\n        setPhase(\"locked\");\n        setStatus(\"Measurements captured! ✔️\");\n        stopCamera();\n      } else {\n        const reasonParts = [];\n        if (bufN.length < STABILITY_FRAMES) reasonParts.push(`need ${STABILITY_FRAMES - bufN.length} more frames`);\n        if (maxDev >= MOVEMENT_EPS) reasonParts.push(\"too much movement\");\n        if (spread >= 3.0) reasonParts.push(\"measurements varying\");\n        setStatus(`Hold still… (${reasonParts.join(\", \")})`);\n      }\n      ctx.restore();\n    });\n    startCamera(pose);\n    return () => {\n      stopCamera();\n    };\n  }, [phase, cmPerPx, getDistance, locked, barPx]);\n  const setCalibration = () => {\n    if (barPx < 40) {\n      setStatus(\"Bar too small - adjust bar width first\");\n      return;\n    }\n    const newCmPerPx = A4_WIDTH_CM / barPx;\n    setCmPerPx(newCmPerPx);\n    setPhase(\"measure\");\n    setStatus(\"Calibration set! Stand centered, show shoulders & upper torso clearly.\");\n    // reset buffers\n    chestBuf.current = [];\n    shoulderBuf.current = [];\n    waistBuf.current = [];\n    recentShoulderN.current = [];\n  };\n  const retake = () => {\n    setLocked(false);\n    setMeas(null);\n    setPhase(\"measure\");\n    setStatus(\"Stand centered; hold still for 1–2 seconds.\");\n    chestBuf.current = [];\n    shoulderBuf.current = [];\n    waistBuf.current = [];\n    recentShoulderN.current = [];\n    if (poseRef.current) startCamera(poseRef.current);\n  };\n  const recalibrate = () => {\n    setLocked(false);\n    setMeas(null);\n    setPhase(\"calibrate\");\n    setCmPerPx(null);\n    setStatus(\"Hold an A4 sheet at chest level and match the bar width.\");\n    chestBuf.current = [];\n    shoulderBuf.current = [];\n    waistBuf.current = [];\n    recentShoulderN.current = [];\n    if (poseRef.current) startCamera(poseRef.current);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"relative w-full min-h-screen bg-gradient-to-b from-[#0b0f14] to-[#111827] flex flex-col items-center\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-full max-w-6xl flex items-center justify-between px-4 pt-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-white font-semibold text-lg\",\n        children: \"AI Fashion Fit \\u2014 Upper Body (Measurements)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 411,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white/90 rounded-full px-3 py-1 text-sm shadow\",\n        children: status\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 412,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-3 text-xs text-white/70 max-w-6xl w-full px-4\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grid grid-cols-2 md:grid-cols-5 gap-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"cmPerPx: \", (_cmPerPx$toFixed = cmPerPx === null || cmPerPx === void 0 ? void 0 : (_cmPerPx$toFixed2 = cmPerPx.toFixed) === null || _cmPerPx$toFixed2 === void 0 ? void 0 : _cmPerPx$toFixed2.call(cmPerPx, 4)) !== null && _cmPerPx$toFixed !== void 0 ? _cmPerPx$toFixed : \"—\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 418,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"shoulderCm: \", (_debugInfo$shoulderCm = debugInfo.shoulderCm) !== null && _debugInfo$shoulderCm !== void 0 ? _debugInfo$shoulderCm : \"—\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 419,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"chestCm: \", (_debugInfo$chestCm = debugInfo.chestCm) !== null && _debugInfo$chestCm !== void 0 ? _debugInfo$chestCm : \"—\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 420,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"predicted size: \", debugInfo.chestCm ? recommendTopSize(parseFloat(debugInfo.chestCm)) : \"—\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 421,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"stable: \", debugInfo.stable ? \"✓\" : \"✗\", \" (\", (_debugInfo$frames = debugInfo.frames) !== null && _debugInfo$frames !== void 0 ? _debugInfo$frames : 0, \" frames)\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 422,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 417,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 416,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"relative w-full max-w-6xl aspect-video mt-4 rounded-2xl overflow-hidden shadow-2xl ring-1 ring-white/10\",\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        ref: videoRef,\n        className: \"absolute inset-0 w-full h-full object-contain bg-black\",\n        autoPlay: true,\n        muted: true,\n        playsInline: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 428,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        className: \"absolute inset-0 w-full h-full object-contain pointer-events-none\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 429,\n        columnNumber: 9\n      }, this), phase === \"calibrate\" && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute bottom-4 left-1/2 -translate-x-1/2 bg-white/95 backdrop-blur rounded-2xl px-4 py-3 flex items-center gap-4 shadow-lg\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-sm font-medium\",\n          children: \"A4 width match\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 434,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"range\",\n          min: 120,\n          max: 900,\n          value: barPx,\n          onChange: e => setBarPx(Number(e.target.value)),\n          className: \"w-72 accent-purple-600\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 435,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-xs text-gray-600\",\n          children: [barPx, \"px\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 443,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: setCalibration,\n          className: \"px-4 py-2 rounded-xl bg-purple-600 text-white hover:bg-purple-700 text-sm shadow\",\n          children: \"Set calibration\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 444,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 433,\n        columnNumber: 11\n      }, this), phase === \"measure\" && !locked && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute top-4 left-4 bg-black/70 text-white p-3 rounded-lg text-sm max-w-xs\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"font-semibold mb-1\",\n          children: \"Tips for better capture:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 456,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          className: \"text-xs space-y-1\",\n          children: [/*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u2022 Stand 6-8 feet from camera\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 458,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u2022 Face camera directly\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 459,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u2022 Keep shoulders level\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 460,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u2022 Hold arms slightly away from body\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 461,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u2022 Stay still for 1-2 seconds\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 462,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 457,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 455,\n        columnNumber: 11\n      }, this), phase === \"locked\" && meas && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute inset-0 bg-black/60 flex items-center justify-center p-4\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-white max-w-md w-full rounded-2xl p-6 shadow-2xl\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-xl font-bold mb-3\",\n            children: \"Upper\\u2011Body Measurements\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 471,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"grid grid-cols-2 gap-y-1 text-[15px]\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: \"Chest (circ.)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 473,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"font-semibold\",\n              children: [meas.chestCm, \" cm\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 473,\n              columnNumber: 41\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: \"Shoulder width\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 474,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"font-semibold\",\n              children: [meas.shoulderCm, \" cm\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 474,\n              columnNumber: 42\n            }, this), meas.upperWaistCm !== undefined && /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                children: \"Upper\\u2011waist (flat)\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 477,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"font-semibold\",\n                children: [meas.upperWaistCm, \" cm\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 477,\n                columnNumber: 50\n              }, this)]\n            }, void 0, true)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 472,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-4 p-4 rounded-xl bg-blue-50 border border-blue-200\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-sm text-blue-900 font-medium\",\n              children: \"T-Shirt Size Recommendation\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 484,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-2xl font-bold text-blue-900 my-2\",\n              children: recommendTopSize(meas.chestCm)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 485,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-xs text-blue-700\",\n              children: [\"Based on \", meas.chestCm, \"cm chest measurement\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 488,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-xs text-blue-600 mt-2 border-t border-blue-200 pt-2\",\n              children: getTshirtFitAdvice(meas.chestCm, meas.shoulderCm)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 491,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 483,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-3 text-xs text-gray-600\",\n            children: [\"Quality \\u2014 frames: \", meas.quality.frames, \", spread: \", meas.quality.spreadCm, \" cm, stability: \", meas.quality.stability]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 496,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-5 flex gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: retake,\n              className: \"px-4 py-2 rounded-xl bg-black text-white hover:opacity-90\",\n              children: \"Retake\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 500,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: recalibrate,\n              className: \"px-4 py-2 rounded-xl bg-gray-200 hover:bg-gray-300\",\n              children: \"Re\\u2011calibrate\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 501,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => window.print(),\n              className: \"px-4 py-2 rounded-xl bg-purple-600 text-white hover:bg-purple-700\",\n              children: \"Save / Print\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 502,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 499,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 470,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 469,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 427,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-3 text-white/60 text-sm text-center px-4 max-w-2xl\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mb-2\",\n        children: /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Instructions:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 510,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 510,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"1. Hold A4 paper at chest level, match the white bar width, click \\\"Set calibration\\\"\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 511,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"2. Stand 6-8 feet back, face camera, keep shoulders visible\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 512,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"3. Hold still for 1-2 seconds until measurements are captured\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 513,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 509,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 408,\n    columnNumber: 5\n  }, this);\n}\n_s(Measure, \"5i4kVRAh8bzw14WsgGOg1PkerEM=\");\n_c = Measure;\nvar _c;\n$RefreshReg$(_c, \"Measure\");","map":{"version":3,"names":["React","useRef","useEffect","useState","useCallback","Pose","Camera","jsxDEV","_jsxDEV","Fragment","_Fragment","A4_WIDTH_CM","CHEST_MULTIPLIER","UPPER_WAIST_FACTOR","UPPER","LOWER","drawSeg","ctx","lm","a","b","color","width","W","H","_A$visibility","_B$visibility","A","B","visibility","strokeStyle","lineWidth","beginPath","moveTo","x","y","lineTo","stroke","drawBBox","pts","filter","p","_p$visibility","length","xs","map","ys","minX","Math","max","min","maxX","minY","maxY","pad","strokeRect","recommendTopSize","chestCm","isNaN","table","size","hit","find","r","getTshirtFitAdvice","shoulderCm","ratio","Measure","_s","_cmPerPx$toFixed","_cmPerPx$toFixed2","_debugInfo$shoulderCm","_debugInfo$chestCm","_debugInfo$frames","videoRef","canvasRef","poseRef","camRef","phase","setPhase","status","setStatus","barPx","setBarPx","cmPerPx","setCmPerPx","locked","setLocked","meas","setMeas","GUIDE_MARGIN","STABILITY_FRAMES","MOVEMENT_EPS","recentShoulderN","chestBuf","shoulderBuf","waistBuf","SHOULDER_MIN","SHOULDER_MAX","CHEST_MIN","CHEST_MAX","debugInfo","setDebugInfo","getDistance","hypot","stopCamera","_camRef$current","_camRef$current$stop","current","stop","call","v","srcObject","getTracks","forEach","t","e","console","log","startCamera","pose","camera","onFrame","readyState","send","image","height","start","error","canvas","getContext","locateFile","file","replace","setOptions","modelComplexity","smoothLandmarks","enableSegmentation","minDetectionConfidence","minTrackingConfidence","onResults","res","save","clearRect","drawImage","gx","gy","gW","gH","barH","fillStyle","fillRect","font","fillText","poseLandmarks","restore","vis","i","_lm$i$visibility","_lm$i","shouldersOK","hipsOK","_lm$11$visibility","_lm$","_lm$12$visibility","_lm$2","_lm$23$visibility","_lm$3","_lm$24$visibility","_lm$4","shoulder11","shoulder12","hip23","hip24","Lsh","Rsh","Lhip","Rhip","hip","shMid","arc","PI","fill","inside","every","insideFrame","shoulderWidthN","torsoHeightN","bufN","push","shift","avg","reduce","maxDev","abs","shoulderPx","chestCmInstant","upperWaistCmInstant","hipFlatCm","pushMed","ref","val","n","s","sort","m","floor","chestMed","shoulderMed","waistMed","spread","stable","shoulderOk","chestOk","toFixed","bufferLength","frames","out","Number","upperWaistCm","undefined","quality","spreadCm","stability","_shoulderPx","reasonParts","join","setCalibration","newCmPerPx","retake","recalibrate","className","children","fileName","_jsxFileName","lineNumber","columnNumber","parseFloat","autoPlay","muted","playsInline","type","value","onChange","target","onClick","window","print","_c","$RefreshReg$"],"sources":["/Users/dhirajbalayar/Desktop/fashion/frontend/src/pages/Measure.jsx"],"sourcesContent":["// src/pages/Measure.jsx\nimport React, { useRef, useEffect, useState, useCallback } from \"react\";\nimport { Pose } from \"@mediapipe/pose\";\nimport { Camera } from \"@mediapipe/camera_utils\";\n\n/* ---------- Calibration ---------- */\nconst A4_WIDTH_CM = 21.0; // reference width\nconst CHEST_MULTIPLIER = 1.95; // bumped: shoulder flat → chest circumference\nconst UPPER_WAIST_FACTOR = 0.90; // hip width ≈ a bit wider than upper waist\n\n/* ---------- Overlay helpers ---------- */\nconst UPPER = [\n  [0,1],[1,2],[2,3],[3,7],\n  [0,11],[0,12],\n  [11,13],[13,15],\n  [12,14],[14,16],\n  [11,12],\n  [11,23],[12,24],\n];\nconst LOWER = [\n  [23,25],[25,27],[27,31],\n  [24,26],[26,28],[28,32],\n  [23,24],\n];\nconst drawSeg = (ctx, lm, a, b, color, width, W, H) => {\n  const A = lm[a], B = lm[b];\n  if (!A || !B) return;\n  if ((A.visibility ?? 0) < 0.4 || (B.visibility ?? 0) < 0.4) return;\n  ctx.strokeStyle = color; ctx.lineWidth = width;\n  ctx.beginPath(); ctx.moveTo(A.x*W, A.y*H); ctx.lineTo(B.x*W, B.y*H); ctx.stroke();\n};\nconst drawBBox = (ctx, lm, W, H, color=\"rgba(0,255,0,0.9)\") => {\n  const pts = lm.filter(p => (p?.visibility ?? 0) > 0.4);\n  if (!pts.length) return;\n  const xs = pts.map(p=>p.x*W), ys = pts.map(p=>p.y*H);\n  const minX = Math.max(0, Math.min(...xs)), maxX = Math.min(W, Math.max(...xs));\n  const minY = Math.max(0, Math.min(...ys)), maxY = Math.min(H, Math.max(...ys));\n  const pad = 8; ctx.strokeStyle = color; ctx.lineWidth = 3;\n  ctx.strokeRect(minX-pad, minY-pad, (maxX-minX)+pad*2, (maxY-minY)+pad*2);\n};\n\n/* ---------- T-Shirt Size recommendation ---------- */\nconst recommendTopSize = (chestCm) => {\n  if (!chestCm || isNaN(chestCm)) return \"Unable to determine\";\n  \n  // Standard T-shirt chest measurements (in cm)\n  const table = [\n    { size: \"XS\", min: 76, max: 84 },\n    { size: \"S\",  min: 84, max: 92 },\n    { size: \"M\",  min: 92, max: 100 },\n    { size: \"L\",  min: 100, max: 108 },\n    { size: \"XL\", min: 108, max: 116 },\n    { size: \"XXL\",min: 116, max: 124 },\n    { size: \"XXXL\",min: 124, max: 132 },\n  ];\n  \n  // Find exact match\n  const hit = table.find(r => chestCm >= r.min && chestCm < r.max);\n  if (hit) return hit.size;\n  \n  // Handle edge cases\n  if (chestCm < table[0].min) return \"XS (might be tight)\";\n  if (chestCm >= table[table.length-1].max) return \"XXXL+ (custom size needed)\";\n  \n  return \"Size not found\";\n};\n\n// T-shirt fit recommendation based on body measurements\nconst getTshirtFitAdvice = (chestCm, shoulderCm) => {\n  if (!chestCm || !shoulderCm) return \"Get measurements first for fit advice.\";\n  \n  const ratio = chestCm / shoulderCm;\n  \n  if (ratio < 2.1) {\n    return \"Consider: Slim/fitted t-shirts will suit your build.\";\n  } else if (ratio > 2.4) {\n    return \"Consider: Regular/relaxed fit t-shirts for comfort.\";\n  } else {\n    return \"Consider: Most t-shirt fits should work well.\";\n  }\n};\n\nexport default function Measure() {\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const poseRef = useRef(null);\n  const camRef = useRef(null);\n\n  const [phase, setPhase] = useState(\"calibrate\"); // 'calibrate' | 'measure' | 'locked'\n  const [status, setStatus] = useState(\"Hold an A4 sheet at chest level and match the bar width.\");\n  const [barPx, setBarPx] = useState(300);\n  const [cmPerPx, setCmPerPx] = useState(null);\n\n  const [locked, setLocked] = useState(false);\n  const [meas, setMeas] = useState(null); // { chestCm, shoulderCm, upperWaistCm, quality, _shoulderPx }\n\n  // Relaxed stability settings for better capture\n  const GUIDE_MARGIN = 0.12; // Increased margin for easier positioning\n  const STABILITY_FRAMES = 8; // Reduced frames needed for stability\n  const MOVEMENT_EPS = 0.025; // Relaxed movement threshold\n  const recentShoulderN = useRef([]);\n  const chestBuf = useRef([]);\n  const shoulderBuf = useRef([]);\n  const waistBuf = useRef([]);\n\n  // Relaxed sanity bounds\n  const SHOULDER_MIN = 30, SHOULDER_MAX = 70; // cm - wider range\n  const CHEST_MIN = 70, CHEST_MAX = 150;      // cm - wider range\n\n  // Debug state\n  const [debugInfo, setDebugInfo] = useState({});\n\n  const getDistance = useCallback((a,b)=>Math.hypot(a.x-b.x,a.y-b.y),[]);\n\n  const stopCamera = () => {\n    try {\n      camRef.current?.stop?.();\n      const v = videoRef.current;\n      if (v?.srcObject) {\n        v.srcObject.getTracks().forEach(t=>t.stop());\n        v.srcObject = null;\n      }\n    } catch(e) {\n      console.log(\"Stop camera error:\", e);\n    }\n  };\n\n  const startCamera = async (pose) => {\n    try {\n      const v = videoRef.current;\n      const camera = new Camera(v, {\n        onFrame: async () => { \n          if (v.readyState === 4) { // HAVE_ENOUGH_DATA\n            await pose.send({ image: v }); \n          }\n        },\n        width: 1280, height: 720,\n      });\n      camRef.current = camera;\n      await camera.start();\n    } catch(e) {\n      console.error(\"Camera start error:\", e);\n      setStatus(\"Camera access failed. Please allow camera permission.\");\n    }\n  };\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext(\"2d\");\n\n    const pose = new Pose({\n      locateFile: (file) => `/mediapipe/pose/${file.replace('simd_', '')}`,\n    });\n    poseRef.current = pose;\n\n    pose.setOptions({\n      modelComplexity: 1,\n      smoothLandmarks: true,\n      enableSegmentation: false,\n      minDetectionConfidence: 0.4, // Lowered for better detection\n      minTrackingConfidence: 0.4,  // Lowered for better tracking\n    });\n\n    pose.onResults((res) => {\n      if (locked) return;\n\n      const W = res.image.width, H = res.image.height;\n      if (canvas.width !== W) canvas.width = W;\n      if (canvas.height !== H) canvas.height = H;\n\n      ctx.save();\n      ctx.clearRect(0,0,W,H);\n      ctx.drawImage(res.image,0,0,W,H);\n\n      // guide box\n      const gx = W*GUIDE_MARGIN, gy = H*GUIDE_MARGIN;\n      const gW = W*(1-GUIDE_MARGIN*2), gH = H*(1-GUIDE_MARGIN*2);\n      ctx.strokeStyle = \"rgba(125,255,160,0.85)\";\n      ctx.lineWidth = 3; ctx.strokeRect(gx, gy, gW, gH);\n\n      // calibration bar\n      if (phase === \"calibrate\") {\n        const barH = 14;\n        ctx.fillStyle = \"rgba(255,255,255,0.95)\";\n        ctx.fillRect((W-barPx)/2, H*0.1, barPx, barH);\n        ctx.font = \"14px system-ui, sans-serif\";\n        ctx.fillStyle = \"rgba(255,255,255,0.95)\";\n        ctx.fillText(\n          \"Match this bar to A4 width (21 cm) at chest depth.\",\n          Math.max(12,(W-360)/2), H*0.1-8\n        );\n      }\n\n      const lm = res.poseLandmarks;\n      if (!lm || lm.length === 0) { \n        setStatus(\"Detecting body…\"); \n        setDebugInfo({error: \"No landmarks detected\"});\n        ctx.restore(); \n        return; \n      }\n\n      // overlay (screenshot style)\n      drawBBox(ctx, lm, W, H);\n      UPPER.forEach(([a,b])=>drawSeg(ctx,lm,a,b,\"#2aa4ff\",3,W,H));\n      LOWER.forEach(([a,b])=>drawSeg(ctx,lm,a,b,\"#ff9933\",3,W,H));\n\n      // Check visibility with lower threshold\n      const vis = (i) => (lm[i]?.visibility ?? 0) > 0.3; // Lowered from 0.45\n      const shouldersOK = vis(11) && vis(12);\n      const hipsOK = vis(23) || vis(24);\n      \n      if (!(shouldersOK && hipsOK)) { \n        setStatus(\"Show shoulders & upper torso clearly.\"); \n        setDebugInfo({\n          shoulder11: lm[11]?.visibility ?? 0,\n          shoulder12: lm[12]?.visibility ?? 0,\n          hip23: lm[23]?.visibility ?? 0,\n          hip24: lm[24]?.visibility ?? 0,\n        });\n        ctx.restore(); \n        return; \n      }\n\n      const Lsh = lm[11], Rsh = lm[12];\n      const Lhip = lm[23], Rhip = lm[24];\n      const hip = vis(23) ? Lhip : Rhip;\n\n      // key dots\n      const shMid = { x:(Lsh.x+Rsh.x)/2, y:(Lsh.y+Rsh.y)/2 };\n      ctx.fillStyle = \"rgba(0,200,255,1)\";\n      [Lsh, Rsh, shMid, hip].forEach(p => { \n        ctx.beginPath(); \n        ctx.arc(p.x*W, p.y*H, 6, 0, Math.PI*2); \n        ctx.fill(); \n      });\n\n      // Relaxed inside check\n      const inside = [Lsh,Rsh,hip].every(p => \n        p.x*W >= (gx-20) && p.x*W <= (gx+gW+20) && \n        p.y*H >= (gy-20) && p.y*H <= (gy+gH+20)\n      );\n      \n      if (!inside) { \n        setStatus(\"Step back/center - get shoulders and torso in frame.\"); \n        setDebugInfo({insideFrame: inside});\n        ctx.restore(); \n        return; \n      }\n\n      if (phase === \"calibrate\") { \n        setStatus(\"Good position! Adjust bar width → Set calibration.\"); \n        ctx.restore(); \n        return; \n      }\n      \n      if (!cmPerPx) { \n        setStatus(\"Click 'Set calibration' first.\"); \n        ctx.restore(); \n        return; \n      }\n\n      // normalized stability\n      const shoulderWidthN = getDistance(Lsh,Rsh);\n      const torsoHeightN = getDistance(shMid, hip);\n      if (torsoHeightN <= 0) { \n        setStatus(\"Hold still…\"); \n        ctx.restore(); \n        return; \n      }\n\n      const bufN = recentShoulderN.current;\n      bufN.push(shoulderWidthN); \n      if (bufN.length > STABILITY_FRAMES) bufN.shift();\n      \n      const avg = bufN.length > 0 ? bufN.reduce((a,b)=>a+b,0)/bufN.length : 0;\n      const maxDev = bufN.length > 0 ? Math.max(...bufN.map(v=>Math.abs(v-avg))) : 999;\n\n      // ----- measurements in cm -----\n      const shoulderPx = Math.abs((Lsh.x - Rsh.x) * W);\n      const shoulderCm = shoulderPx * cmPerPx;\n      const chestCmInstant = shoulderCm * CHEST_MULTIPLIER;\n\n      let upperWaistCmInstant = null;\n      if (vis(23) && vis(24)) {\n        const hipFlatCm = Math.abs((Lhip.x - Rhip.x) * W) * cmPerPx;\n        upperWaistCmInstant = hipFlatCm * UPPER_WAIST_FACTOR;\n      }\n\n      // median smoothing with shorter buffer for faster response\n      const pushMed = (ref, val, n=8) => { // Reduced from 15 to 8\n        if (val==null) return null;\n        ref.current.push(val);\n        if (ref.current.length>n) ref.current.shift();\n        const s=[...ref.current].sort((a,b)=>a-b);\n        const m=Math.floor(s.length/2);\n        return s.length%2 ? s[m] : (s[m-1]+s[m])/2;\n      };\n      \n      const chestMed = pushMed(chestBuf, chestCmInstant);\n      const shoulderMed = pushMed(shoulderBuf, shoulderCm);\n      const waistMed = pushMed(waistBuf, upperWaistCmInstant);\n\n      // Relaxed stability check\n      const spread = chestBuf.current.length >= 5 ? \n        Math.max(...chestBuf.current) - Math.min(...chestBuf.current) : 999;\n      const stable = bufN.length >= STABILITY_FRAMES && maxDev < MOVEMENT_EPS && spread < 3.0; // Relaxed spread\n\n      // Relaxed sanity check\n      const shoulderOk = shoulderMed > SHOULDER_MIN && shoulderMed < SHOULDER_MAX;\n      const chestOk = chestMed > CHEST_MIN && chestMed < CHEST_MAX;\n\n      // Update debug info\n      setDebugInfo({\n        shoulderPx: shoulderPx.toFixed(1),\n        shoulderCm: shoulderMed?.toFixed(1),\n        chestCm: chestMed?.toFixed(1),\n        stable,\n        maxDev: maxDev.toFixed(4),\n        spread: spread.toFixed(2),\n        bufferLength: bufN.length,\n        shoulderOk,\n        chestOk,\n        frames: chestBuf.current.length\n      });\n\n      if (stable && chestMed && shoulderMed) {\n        if (!shoulderOk || !chestOk) {\n          setStatus(`Calibration issue - Shoulder: ${shoulderMed?.toFixed(1)}cm, Chest: ${chestMed?.toFixed(1)}cm - Please recalibrate.`);\n          ctx.restore();\n          return;\n        }\n        \n        const out = {\n          chestCm: Number(chestMed.toFixed(1)),\n          shoulderCm: Number(shoulderMed.toFixed(1)),\n          upperWaistCm: waistMed ? Number(waistMed.toFixed(1)) : undefined,\n          quality: { \n            frames: chestBuf.current.length, \n            spreadCm: Number(spread.toFixed(2)),\n            stability: Number(maxDev.toFixed(4))\n          },\n          _shoulderPx: Number(shoulderPx.toFixed(1))\n        };\n\n        setMeas(out);\n        setLocked(true);\n        setPhase(\"locked\");\n        setStatus(\"Measurements captured! ✔️\");\n        stopCamera();\n      } else {\n        const reasonParts = [];\n        if (bufN.length < STABILITY_FRAMES) reasonParts.push(`need ${STABILITY_FRAMES - bufN.length} more frames`);\n        if (maxDev >= MOVEMENT_EPS) reasonParts.push(\"too much movement\");\n        if (spread >= 3.0) reasonParts.push(\"measurements varying\");\n        \n        setStatus(`Hold still… (${reasonParts.join(\", \")})`);\n      }\n\n      ctx.restore();\n    });\n\n    startCamera(pose);\n    return () => { stopCamera(); };\n  }, [phase, cmPerPx, getDistance, locked, barPx]);\n\n  const setCalibration = () => {\n    if (barPx < 40) {\n      setStatus(\"Bar too small - adjust bar width first\");\n      return;\n    }\n    const newCmPerPx = A4_WIDTH_CM / barPx;\n    setCmPerPx(newCmPerPx);\n    setPhase(\"measure\");\n    setStatus(\"Calibration set! Stand centered, show shoulders & upper torso clearly.\");\n    // reset buffers\n    chestBuf.current = []; \n    shoulderBuf.current = []; \n    waistBuf.current = []; \n    recentShoulderN.current = [];\n  };\n\n  const retake = () => {\n    setLocked(false); \n    setMeas(null); \n    setPhase(\"measure\");\n    setStatus(\"Stand centered; hold still for 1–2 seconds.\");\n    chestBuf.current = []; \n    shoulderBuf.current = []; \n    waistBuf.current = []; \n    recentShoulderN.current = [];\n    if (poseRef.current) startCamera(poseRef.current);\n  };\n\n  const recalibrate = () => {\n    setLocked(false); \n    setMeas(null); \n    setPhase(\"calibrate\");\n    setCmPerPx(null);\n    setStatus(\"Hold an A4 sheet at chest level and match the bar width.\");\n    chestBuf.current = []; \n    shoulderBuf.current = []; \n    waistBuf.current = []; \n    recentShoulderN.current = [];\n    if (poseRef.current) startCamera(poseRef.current);\n  };\n\n  return (\n    <div className=\"relative w-full min-h-screen bg-gradient-to-b from-[#0b0f14] to-[#111827] flex flex-col items-center\">\n      {/* Header */}\n      <div className=\"w-full max-w-6xl flex items-center justify-between px-4 pt-4\">\n        <div className=\"text-white font-semibold text-lg\">AI Fashion Fit — Upper Body (Measurements)</div>\n        <div className=\"bg-white/90 rounded-full px-3 py-1 text-sm shadow\">{status}</div>\n      </div>\n\n      {/* Enhanced DEBUG PANEL */}\n      <div className=\"mt-3 text-xs text-white/70 max-w-6xl w-full px-4\">\n        <div className=\"grid grid-cols-2 md:grid-cols-5 gap-2\">\n          <div>cmPerPx: {cmPerPx?.toFixed?.(4) ?? \"—\"}</div>\n          <div>shoulderCm: {debugInfo.shoulderCm ?? \"—\"}</div>\n          <div>chestCm: {debugInfo.chestCm ?? \"—\"}</div>\n          <div>predicted size: {debugInfo.chestCm ? recommendTopSize(parseFloat(debugInfo.chestCm)) : \"—\"}</div>\n          <div>stable: {debugInfo.stable ? \"✓\" : \"✗\"} ({debugInfo.frames ?? 0} frames)</div>\n        </div>\n      </div>\n\n      {/* Camera */}\n      <div className=\"relative w-full max-w-6xl aspect-video mt-4 rounded-2xl overflow-hidden shadow-2xl ring-1 ring-white/10\">\n        <video ref={videoRef} className=\"absolute inset-0 w-full h-full object-contain bg-black\" autoPlay muted playsInline />\n        <canvas ref={canvasRef} className=\"absolute inset-0 w-full h-full object-contain pointer-events-none\" />\n\n        {/* Calibration UI */}\n        {phase === \"calibrate\" && (\n          <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 bg-white/95 backdrop-blur rounded-2xl px-4 py-3 flex items-center gap-4 shadow-lg\">\n            <div className=\"text-sm font-medium\">A4 width match</div>\n            <input \n              type=\"range\" \n              min={120} \n              max={900} \n              value={barPx} \n              onChange={(e)=>setBarPx(Number(e.target.value))} \n              className=\"w-72 accent-purple-600\" \n            />\n            <div className=\"text-xs text-gray-600\">{barPx}px</div>\n            <button \n              onClick={setCalibration} \n              className=\"px-4 py-2 rounded-xl bg-purple-600 text-white hover:bg-purple-700 text-sm shadow\"\n            >\n              Set calibration\n            </button>\n          </div>\n        )}\n\n        {/* Measure phase helper */}\n        {phase === \"measure\" && !locked && (\n          <div className=\"absolute top-4 left-4 bg-black/70 text-white p-3 rounded-lg text-sm max-w-xs\">\n            <div className=\"font-semibold mb-1\">Tips for better capture:</div>\n            <ul className=\"text-xs space-y-1\">\n              <li>• Stand 6-8 feet from camera</li>\n              <li>• Face camera directly</li>\n              <li>• Keep shoulders level</li>\n              <li>• Hold arms slightly away from body</li>\n              <li>• Stay still for 1-2 seconds</li>\n            </ul>\n          </div>\n        )}\n\n        {/* Results */}\n        {phase === \"locked\" && meas && (\n          <div className=\"absolute inset-0 bg-black/60 flex items-center justify-center p-4\">\n            <div className=\"bg-white max-w-md w-full rounded-2xl p-6 shadow-2xl\">\n              <div className=\"text-xl font-bold mb-3\">Upper‑Body Measurements</div>\n              <div className=\"grid grid-cols-2 gap-y-1 text-[15px]\">\n                <div>Chest (circ.)</div><div className=\"font-semibold\">{meas.chestCm} cm</div>\n                <div>Shoulder width</div><div className=\"font-semibold\">{meas.shoulderCm} cm</div>\n                {meas.upperWaistCm !== undefined && (\n                  <>\n                    <div>Upper‑waist (flat)</div><div className=\"font-semibold\">{meas.upperWaistCm} cm</div>\n                  </>\n                )}\n              </div>\n\n              {/* T-Shirt Size Recommendation */}\n              <div className=\"mt-4 p-4 rounded-xl bg-blue-50 border border-blue-200\">\n                <div className=\"text-sm text-blue-900 font-medium\">T-Shirt Size Recommendation</div>\n                <div className=\"text-2xl font-bold text-blue-900 my-2\">\n                  {recommendTopSize(meas.chestCm)}\n                </div>\n                <div className=\"text-xs text-blue-700\">\n                  Based on {meas.chestCm}cm chest measurement\n                </div>\n                <div className=\"text-xs text-blue-600 mt-2 border-t border-blue-200 pt-2\">\n                  {getTshirtFitAdvice(meas.chestCm, meas.shoulderCm)}\n                </div>\n              </div>\n\n              <div className=\"mt-3 text-xs text-gray-600\">\n                Quality — frames: {meas.quality.frames}, spread: {meas.quality.spreadCm} cm, stability: {meas.quality.stability}\n              </div>\n              <div className=\"mt-5 flex gap-2\">\n                <button onClick={retake} className=\"px-4 py-2 rounded-xl bg-black text-white hover:opacity-90\">Retake</button>\n                <button onClick={recalibrate} className=\"px-4 py-2 rounded-xl bg-gray-200 hover:bg-gray-300\">Re‑calibrate</button>\n                <button onClick={()=>window.print()} className=\"px-4 py-2 rounded-xl bg-purple-600 text-white hover:bg-purple-700\">Save / Print</button>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      <div className=\"mt-3 text-white/60 text-sm text-center px-4 max-w-2xl\">\n        <p className=\"mb-2\"><strong>Instructions:</strong></p>\n        <p>1. Hold A4 paper at chest level, match the white bar width, click \"Set calibration\"</p>\n        <p>2. Stand 6-8 feet back, face camera, keep shoulders visible</p>\n        <p>3. Hold still for 1-2 seconds until measurements are captured</p>\n      </div>\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}